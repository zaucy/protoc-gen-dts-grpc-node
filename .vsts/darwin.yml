steps:

- script: sudo xcodebuild -license accept
  workingDirectory: $(Build.SourcesDirectory)/packages/protoc-gen-dts-grpc-node
- script: curl -L -o ./bazel-installer.sh https://github.com/bazelbuild/bazel/releases/download/0.16.1/bazel-0.16.1-installer-darwin-x86_64.sh 
  workingDirectory: $(Build.SourcesDirectory)/packages/protoc-gen-dts-grpc-node

- script: chmod +x ./bazel-installer.sh && ./bazel-installer.sh --user
  workingDirectory: $(Build.SourcesDirectory)/packages/protoc-gen-dts-grpc-node

- script: bazel build javascript/net/grpc/web:protoc-gen-dts-grpc-node -c opt && cp ./bazel-out/darwin-opt/bin/javascript/net/grpc/web/protoc-gen-dts-grpc-node ./packages/protoc-gen-dts-grpc-node/bin/protoc-gen-dts-grpc-node-darwin
  workingDirectory: $(Build.SourcesDirectory)

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: $(Build.SourcesDirectory)/packages/protoc-gen-dts-grpc-node/bin/protoc-gen-dts-grpc-node-darwin
    artifactName: protoc-gen-dts-grpc-node-darwin 
